<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>BJJ 롤 스타일 테스트 — 탑 vs 가드 (분석 리포트)</title>
<meta name="description" content="주짓수 롤 스타일 11문항 테스트: 탑 플레이어 vs 가드 플레이어 — 결과를 분석 리포트로 제공합니다." />
<style>
  :root{
    --fg:#0f172a; --muted:#64748b; --bg:#ffffff; --card:#f8fafc;
    --accent:#2563eb; --accent2:#14b8a6; --warn:#f59e0b; --border:#e2e8f0;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,'Apple SD Gothic Neo','Noto Sans KR',Arial,sans-serif;color:var(--fg);background:linear-gradient(180deg,#fff,#f6f9ff 45%,#eef3ff)}
  .wrap{max-width:920px;margin:0 auto;padding:24px}
  header{margin:4px 0 16px}
  h1{font-size:28px;margin:0 0 6px}
  p.lead{color:var(--muted);margin:0}
  .card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:18px;margin:12px 0}
  .q-title{font-weight:800;margin-bottom:10px}
  .opt{display:block;background:#fff;border:1px solid var(--border);border-radius:12px;padding:12px;cursor:pointer;margin:8px 0;transition:all .15s}
  .opt:hover{border-color:var(--accent)}
  input[type=radio]{accent-color:var(--accent);transform:scale(1.15);margin-right:8px}
  .actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:14px}
  button{border:0;border-radius:12px;padding:12px 16px;font-weight:700;cursor:pointer}
  .primary{background:var(--accent);color:#fff}
  .ghost{background:#fff;border:1px solid var(--border)}
  .success{background:var(--accent2);color:#fff}
  .muted{color:var(--muted)}
  .progress{height:8px;background:#eaeef4;border-radius:99px;overflow:hidden;margin:10px 0 6px}
  .bar{height:100%;width:0;background:linear-gradient(90deg,var(--accent),#6ee7b7)}
  .small{font-size:13px}
  .result h2{margin:8px 0 6px}
  .grid{display:grid;grid-template-columns:1fr;gap:12px}
  @media(min-width:860px){.grid{grid-template-columns:1.1fr 0.9fr}}
  .pill{display:inline-block;padding:6px 10px;border:1px solid var(--border);border-radius:999px;background:#fff;margin:4px 6px 0 0;font-size:12px}
  .footer{margin:20px 0;color:var(--muted);font-size:12px}
  .hidden{display:none}
  .sharebox{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
  input.link{flex:1 1 260px;border:1px solid var(--border);border-radius:10px;padding:10px;background:#fff}
  .kpis{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  .kbar{background:#fff;border:1px solid var(--border);border-radius:12px;padding:10px}
  .klabel{font-size:12px;color:var(--muted);margin-bottom:6px}
  .kfill{height:10px;background:linear-gradient(90deg,var(--accent),#60a5fa);border-radius:999px;width:0}
  .kfill2{height:10px;background:linear-gradient(90deg,#22c55e,#a3e635);border-radius:999px;width:0}
  .taglist{margin-top:6px}
  .callout{background:#fff;border:1px dashed var(--border);padding:10px;border-radius:12px}
  .warn{color:#b45309}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>BJJ 롤 스타일 테스트 🧭</h1>
    <p class="lead">11문항으로 **탑 vs 가드** 성향을 측정하고, 결과를 **분석 리포트**로 보여드립니다.</p>
  </header>

  <div class="progress" aria-hidden="true"><div class="bar" id="bar"></div></div>
  <div class="small muted" id="count">0 / 11</div>

  <form id="quiz" class="card"></form>

  <div class="actions">
    <button type="button" class="ghost" id="prevBtn">이전</button>
    <button type="button" class="primary" id="nextBtn">다음</button>
    <button type="submit" class="success hidden" id="submitBtn">결과 보기</button>
  </div>

  <section id="result" class="card result hidden"></section>

  <div class="footer">ⓒ 2025 MK Corporation • 취미용 테스트이며 실제 훈련은 코치와 상의하세요.</div>
</div>

<script>
/* =========================
   분류: 탑 / 가드 / (유머) 애매
   - 초기 화면에는 '애매' 언급 없음
   - 결과가 애매하면 유머러스하게 표현
   - 분석 리포트: 점수, 일관성, 핵심 드라이버, 보완 포인트
========================= */
const CATS = {
  TOP:   { key:"TOP",   name:"탑 플레이어",   desc:"패싱과 포지션 컨트롤로 상위에서 압박합니다." },
  GUARD: { key:"GUARD", name:"가드 플레이어", desc:"하위 포지션에서 각종 가드로 주도권을 잡습니다." },
  NONE:  { key:"NONE",  name:"판단 보류(!)",  desc:"오늘은 우주가 당신의 성향을 숨겼어요 😅 다음 롤에서 힌트를 더 주세요!" }
};

// 11문항 — guard/top 축 점수와 분석 힌트/태그를 함께 수집
const QUESTIONS = [
  { id:"pref", title:"1) 롤 시작 기본 선호는?", options:[
    {label:"시팅 가드/가드풀", map:{guard:2, top:0}, hint:"가드풀 선호", tags:["시팅가드","가드풀"]},
    {label:"테이크다운으로 탑", map:{guard:0, top:2}, hint:"업/다운 자신감", tags:["테이크다운","탑선점"]},
    {label:"상대 따라 유연", map:{guard:1, top:1}, hint:"전술 유연성", tags:["전술유연","상대대응"]} ]},
  { id:"passing", title:"2) 패스 vs 스윕 성공률?", options:[
    {label:"스윕/서브가 더 잘됨", map:{guard:2, top:0}, hint:"스윕 위협", tags:["스윕체인","바텀서브"]},
    {label:"패싱/컨트롤이 강함", map:{guard:0, top:2}, hint:"패싱 압박", tags:["니컷/롱스텝","사이드컨트롤"]},
    {label:"비슷하다", map:{guard:1, top:1}, hint:"균형형", tags:["밸런스"]} ]},
  { id:"guards", title:"3) 즐겨 쓰는 가드 타입?", options:[
    {label:"버터플라이/데라/라쏘", map:{guard:2, top:0}, hint:"모빌 가드", tags:["버터플라이","데라히바"]},
    {label:"클로즈드/하프→스윕", map:{guard:2, top:0}, hint:"전통 가드", tags:["클로즈드","하프"]},
    {label:"가드보단 패싱", map:{guard:0, top:2}, hint:"패스 지향", tags:["패스체인","베이스"]} ]},
  { id:"wrestle", title:"4) 레슬링/업다운 자신감?", options:[
    {label:"낮음(가드풀 편함)", map:{guard:2, top:0}, hint:"업다운 보완", tags:["업다운보완"]},
    {label:"높음(탑 가져감)", map:{guard:0, top:2}, hint:"업다운 강점", tags:["업다운강점"]},
    {label:"보통", map:{guard:1, top:1}, hint:"평균", tags:["평균"]} ]},
  { id:"pace", title:"5) 템포/운영 스타일?", options:[
    {label:"리액티브(카운터/세팅)", map:{guard:2, top:1}, hint:"리액티브 운영", tags:["카운터","세팅"]},
    {label:"프로액티브(압박/패싱)", map:{guard:0, top:2}, hint:"프로액티브 압박", tags:["압박","라인브레이크"]},
    {label:"상황 스위치", map:{guard:1, top:1}, hint:"전환형", tags:["전환"]} ]},
  { id:"subs", title:"6) 제출기 경향?", options:[
    {label:"삼각/암바 등 바텀 서브", map:{guard:2, top:0}, hint:"바텀 서브 체인", tags:["삼각","암바"]},
    {label:"초크/아메리카나 등 탑 서브", map:{guard:0, top:2}, hint:"탑 서브 체인", tags:["초크","아메리카나"]},
    {label:"둘 다 나온다", map:{guard:1, top:1}, hint:"이중 위협", tags:["이중위협"]} ]},
  { id:"passes", title:"7) 주력 패스/브레이크다운?", options:[
    {label:"가드 전개/언밸런싱", map:{guard:2, top:0}, hint:"언밸런싱", tags:["언밸런싱","엔트리"]},
    {label:"니컷/롱스텝/토리안도", map:{guard:0, top:2}, hint:"패스 체인", tags:["니컷","롱스텝","토리안도"]},
    {label:"상황 따라 섞음", map:{guard:1, top:1}, hint:"믹스 전략", tags:["믹스"]} ]},
  { id:"pressure", title:"8) 압박/무게중심 컨트롤?", options:[
    {label:"중간 이하", map:{guard:1, top:0}, hint:"압박 과제", tags:["압박보완"]},
    {label:"강하다", map:{guard:0, top:2}, hint:"압박 강점", tags:["헤비프레셔"]},
    {label:"보통", map:{guard:1, top:1}, hint:"평균 압박", tags:["평균압박"]} ]},
  { id:"retention", title:"9) 가드 리텐션 자신감?", options:[
    {label:"높음", map:{guard:2, top:0}, hint:"리텐션 강점", tags:["리텐션"]},
    {label:"낮음", map:{guard:0, top:1}, hint:"리텐션 과제", tags:["리텐션보완"]},
    {label:"보통", map:{guard:1, top:1}, hint:"보통", tags:["보통"]} ]},
  { id:"coach", title:"10) 코치가 더 강조하는 건?", options:[
    {label:"가드 디테일", map:{guard:2, top:0}, hint:"가드 디테일", tags:["그립/각도"]},
    {label:"패스 디테일", map:{guard:0, top:2}, hint:"패스 디테일", tags:["헤드포지션","베이스"]},
    {label:"전환/타이밍", map:{guard:1, top:1}, hint:"전환 디테일", tags:["타이밍"]} ]},
  { id:"mind", title:"11) 어디서 더 자신감?", options:[
    {label:"바텀", map:{guard:2, top:0}, hint:"바텀 자신감", tags:["바텀세이프"]},
    {label:"탑", map:{guard:0, top:2}, hint:"탑 자신감", tags:["탑세이프"]},
    {label:"둘 다", map:{guard:1, top:1}, hint:"양면 자신감", tags:["양면세이프"]} ]}
];

const quizEl = document.getElementById('quiz');
const barEl = document.getElementById('bar');
const countEl = document.getElementById('count');
const prevBtn = document.getElementById('prevBtn');
const nextBtn = document.getElementById('nextBtn');
const submitBtn = document.getElementById('submitBtn');
const resultEl = document.getElementById('result');

let currentIndex = 0;
const answers = {}; // id -> option index
const dim = { guard:0, top:0 };

function renderQuestion(i){
  quizEl.innerHTML = '';
  const q = QUESTIONS[i];
  const title = document.createElement('div');
  title.className='q-title';
  title.textContent = q.title;
  quizEl.appendChild(title);

  q.options.forEach((opt, idx) => {
    const label = document.createElement('label');
    label.className = 'opt';
    const input = document.createElement('input');
    input.type = 'radio';
    input.name = q.id;
    input.value = idx;
    input.checked = answers[q.id] === idx;
    input.addEventListener('change', ()=> { answers[q.id] = idx; updateNav(); });
    const span = document.createElement('span');
    span.textContent = opt.label;
    label.appendChild(input);
    label.appendChild(span);
    quizEl.appendChild(label);
  });

  updateProgress();
  updateNav();
}

function updateProgress(){
  const answered = Object.keys(answers).length;
  const pct = Math.round((answered/QUESTIONS.length)*100);
  barEl.style.width = pct + '%';
  countEl.textContent = `${Math.min(currentIndex+1, QUESTIONS.length)} / ${QUESTIONS.length}`;
}

function updateNav(){
  prevBtn.disabled = currentIndex===0;
  const q = QUESTIONS[currentIndex];
  const hasAnswer = answers[q.id] !== undefined;
  nextBtn.classList.toggle('hidden', currentIndex >= QUESTIONS.length-1);
  submitBtn.classList.toggle('hidden', currentIndex < QUESTIONS.length-1);
  nextBtn.disabled = !hasAnswer;
  submitBtn.disabled = !hasAnswer;
}

/* ======= 분석 로직 ======= */
function computeDims(){
  dim.guard = 0; dim.top = 0;
  Object.entries(answers).forEach(([qid, idx])=>{
    const opt = QUESTIONS.find(q=>q.id===qid).options[idx];
    dim.guard += opt.map.guard; dim.top += opt.map.top;
  });
  return dim;
}

// 임계값: 총점 낮거나, 격차가 작은 경우 → NONE(유머)
function classify(g, t){
  const total = g + t;
  const diff  = Math.abs(g - t);
  if (total <= 8) return CATS.NONE;      // 데이터 부족/일관성 낮음
  if (diff <= 2)  return CATS.NONE;      // 거의 비등비등
  return (g > t) ? CATS.GUARD : CATS.TOP;
}

function collectDrivers(){
  const hints = new Map();   // hint -> count
  const tags  = new Map();   // tag  -> count
  Object.entries(answers).forEach(([qid, idx])=>{
    const opt = QUESTIONS.find(q=>q.id===qid).options[idx];
    if (opt.hint) hints.set(opt.hint, (hints.get(opt.hint)||0)+1);
    (opt.tags||[]).forEach(t=> tags.set(t, (tags.get(t)||0)+1));
  });
  // 상위 5개만 추려서 반환
  const topHints = [...hints.entries()].sort((a,b)=>b[1]-a[1]).slice(0,5).map(([k])=>k);
  const topTags  = [...tags.entries()].sort((a,b)=>b[1]-a[1]).slice(0,8).map(([k])=>k);
  return { topHints, topTags };
}

function coachTipsFor(cat){
  if (cat.key === "TOP") return [
    "니컷·롱스텝·토리안도 3체인 속도 유지",
    "헤드포지션/언더훅 우선 — 베이스 깨지지 않기",
    "패스→사이드→마운트 3초 규칙(컨트롤 시간 확보)",
    "탑 서브(초크/암트라) 피니시 루틴 정형화"
  ];
  if (cat.key === "GUARD") return [
    "리텐션 루틴(그란비/힙스케이프) 5분 드릴",
    "언밸런싱→스윕 2-3단 연결(버터플라이/사이즈업)",
    "가드에서 이중 위협(스윕+서브) 각도 만들기",
    "그립 파이팅/프레임 디테일(손 위치, 각도, 타이밍)"
  ];
  // NONE (유머 + 개선 포인트 가볍게)
  return [
    "오늘 컨디션: '랜덤 셀렉트' 🎲 — 다음 롤에서 단 하나의 목표만!",
    "가드 1종·패스 1종을 '고정픽'으로 선택해 성공률 체크",
    "업/다운 기본기(스탠스·레벨체인지) 10분 루틴",
    "자주 막히는 상황 하나만 메모하고 바로 복기"
  ];
}

function showResult(){
  computeDims();
  const g = dim.guard, t = dim.top;
  const cat = classify(g, t);
  const total = g + t;
  const diff  = Math.abs(g - t);
  const guardPct = Math.round((g/22)*100);
  const topPct   = Math.round((t/22)*100);
  const consist  = (total>0) ? Math.round((diff/total)*100) : 0; // 일관성 지수(%)

  const { topHints, topTags } = collectDrivers();
  const tips = coachTipsFor(cat).map(t=>`<span class="pill">${t}</span>`).join('');

  // 결과 헤더 문구(유머 포함)
  let headline = `결과: ${cat.name}`;
  let subline  = cat.desc;
  if (cat.key === "NONE") {
    headline = "결과: 판단 보류 😅";
    subline  = "가드/탑 지표가 비슷하거나 데이터가 부족해요. 오늘은 '다재다능'으로 포장해봅시다!";
  }

  // 공유 링크 (점수 포함)
  const payload = { g, t, v:2, cat:cat.key };
  const encoded = btoa(unescape(encodeURIComponent(JSON.stringify(payload))));
  const shareUrl = `${location.origin}${location.pathname}#r=${encoded}`;

  resultEl.innerHTML = `
    <h2>${headline}</h2>
    <div class="muted">${subline}</div>

    <div class="grid" style="margin-top:10px">
      <div class="card" style="background:#fff">
        <div class="kpis">
          <div class="kbar">
            <div class="klabel">가드 성향</div>
            <div class="kfill" id="kg" style="width:${guardPct}%"></div>
            <div class="small muted" style="margin-top:6px">${g} / 22 (${guardPct}%)</div>
          </div>
          <div class="kbar">
            <div class="klabel">탑 성향</div>
            <div class="kfill2" id="kt" style="width:${topPct}%"></div>
            <div class="small muted" style="margin-top:6px">${t} / 22 (${topPct}%)</div>
          </div>
        </div>

        <div class="callout" style="margin-top:12px">
          <div class="small muted">일관성 지수</div>
          <div style="margin-top:4px;font-weight:700">${consist}%</div>
          <div class="small muted">※ 값이 높을수록 한쪽 성향이 뚜렷합니다.</div>
        </div>
      </div>

      <div class="card" style="background:#fff">
        <div class="small muted">핵심 드라이버(답변 패턴 요약)</div>
        <div class="taglist">
          ${topHints.map(h=>`<span class="pill">${h}</span>`).join('') || '<span class="pill">데이터가 더 필요해요</span>'}
        </div>
        <div class="small muted" style="margin-top:10px">당신의 태그</div>
        <div class="taglist">
          ${topTags.map(tg=>`<span class="pill">${tg}</span>`).join('') || '<span class="pill">—</span>'}
        </div>
      </div>
    </div>

    <div class="card" style="background:#fff;margin-top:12px">
      <div class="small muted">코칭 포인트(훈련 추천)</div>
      <div class="taglist">${tips}</div>
    </div>

    <div class="card" style="background:#fff;margin-top:12px">
      <div class="small muted">공유</div>
      <div class="sharebox">
        <input class="link" id="shareLink" readonly value="${shareUrl}" />
        <button class="ghost" id="copyBtn">링크 복사</button>
        <button class="primary" id="webshareBtn">공유하기</button>
        <button class="ghost" id="retryBtn">다시하기</button>
      </div>
    </div>
  `;
  resultEl.classList.remove('hidden');

  document.getElementById('copyBtn').onclick = async ()=>{
    try{
      const linkEl = document.getElementById('shareLink');
      linkEl.select(); linkEl.setSelectionRange(0, 99999);
      await navigator.clipboard.writeText(linkEl.value);
      alert('공유 링크를 복사했어요!');
    }catch(e){ alert('복사에 실패했어요. 수동으로 복사해주세요.'); }
  };
  document.getElementById('webshareBtn').onclick = async ()=>{
    const text = `내 BJJ 롤 스타일 결과 — 가드:${g}, 탑:${t}, 일관성:${consist}%`;
    const url = document.getElementById('shareLink').value;
    if (navigator.share){ try{ await navigator.share({title:'BJJ 롤 스타일', text, url}); }catch(_){}} 
    else { alert('이 기기에서는 기본 공유가 지원되지 않아요. 링크를 복사해 공유해주세요!'); }
  };
  document.getElementById('retryBtn').onclick = ()=>{ location.hash=''; location.reload(); };
}

/* ========== 네비게이션 ========== */
prevBtn.addEventListener('click', ()=>{
  if(currentIndex>0) currentIndex--;
  renderQuestion(currentIndex);
});
nextBtn.addEventListener('click', ()=>{
  const q = QUESTIONS[currentIndex];
  if(answers[q.id]===undefined){ alert('선택해주세요.'); return; }
  if(currentIndex<QUESTIONS.length-1) currentIndex++;
  renderQuestion(currentIndex);
});
document.querySelector('form').addEventListener('submit', (e)=>{
  e.preventDefault();
  const q = QUESTIONS[currentIndex];
  if(answers[q.id]===undefined){ alert('선택해주세요.'); return; }
  showResult();
  window.scrollTo({top:0, behavior:'smooth'});
});

/* ========== 해시 복원(공유 링크) ========== */
function tryRestoreFromHash(){
  const m = location.hash.match(/#r=([^&]+)/);
  if(!m) return false;
  try{
    const json = decodeURIComponent(escape(atob(m[1])));
    const payload = JSON.parse(json);
    if (!payload || payload.v!==2) return false;
    // 결과 보기 전용 — 점수만 복원해서 리포트 바로 노출
    Object.keys(answers).forEach(k=>delete answers[k]);
    // 미니 렌더(진행바 채우기)
    currentIndex = QUESTIONS.length-1;
    renderQuestion(currentIndex);
    dim.guard = payload.g||0; dim.top = payload.t||0;
    showResult();
    return true;
  }catch(e){ return false; }
}

/* 초기 렌더 */
if(!tryRestoreFromHash()){ renderQuestion(0); }
</script>
</body>
</html>
